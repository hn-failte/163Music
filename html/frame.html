<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="../css/frame.css" rel="stylesheet" />
    <link href="../lib/bootstrap-3.3.7-dist/css/bootstrap.css" rel="stylesheet">
    <script src="../lib/jquery.js"></script>
    <script src="../lib/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <link rel="stylesheet" href="../css/my_list.css">
    <link rel="stylesheet" href="../css/music_bar.css">
    <script src="../lib/layer/layer.js"></script>

</head>
<body>
    <div class="head">
        <div class="nav">
            <div class="div1">
                <img src="../img/images/a_03.jpg" />
            </div>
            <div class="div2">
                <ul>
                    <li><a href="#">发现音乐</a></li>
                    <li><a href="#">我的音乐</a></li>
                    <li><a href="#">朋友</a></li>
                    <li><a href="#">商城</a></li>
                    <li><a href="#">音乐人</a></li>
                    <li><a href="#">下载客户端</a></li>
                </ul>
            </div>
            <div class="div3">
                <form>
                    <input id="search" type="text" class="text">
                </form>
                <div class="czzzx">
                    创作者中心
                </div>
                <img src="../img/images/a_09.jpg" />

                <div class="dropdown">
                    <button  class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" aria-haspopup="true" aria-expanded="true">
                      登录
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                      <li class="li1"><a href="./login-T.html">手机号登录</a></li>
                      <li class="li2"><a href="./login-T.html">微信登录</a></li>
                      <li class="li3"><a href="./login-T.html">QQ登录</a></li>
                      <li class="li4"><a href="./login-T.html">新浪微博登录</a></li>
                      <li class="li5"><a href="./login-T.html">网易邮箱账号登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- 导航栏结束 -->










    <!-- 底部播放栏 -->
    <div class="di">

        <div class="player">
            <p></p>
            <audio id="audio" src="" controls="controls"></audio>
            <button class="glyphicon glyphicon-align-justify"></button>
            <ul id="asideList">
                <li>111</li>
            </ul>
        </div>
        
    </div>




</body>
<script src="../js/music_bar.js"></script>
<script>
    $("li").mouseenter(function(){
        $(this).find("a").css({
            "color":"white",  
            // "background": "url(../img/images/b2_03.jpg) no-repeat",
            // "background-size": "20px 25px"
            "background":"black"
        });
    });

    $("li").mouseleave(function(){
        $(this).find("a").css({
            "color":"white",
            "background":"#2D2D2D"
        });

    });

    $(".btn").click(function(){
        location.href="login-T.html";
    });
    $(".btn").mouseenter(function(){
        $(".dropdown-menu").css("display","block");
    });
    $(".dropdown-menu").mouseleave(function(){
        $(".dropdown-menu").css("display","none");
    });
    $(".dropdown").mouseenter(function(){
        $(this).css("display","block");
    });








    $().ready(function(){
        getList();
    });

    function getList() {
        $.ajax({
            url: "http://127.0.0.1:8086/php/crud.php",
            type: "get",
            data: "action=gl&u_id=1",
            dataType: "json",
            success: function(res){
                var data="";
                for(let item in res){
                    data+=`<li list_id="${res[item]["list_id"]}"><span class="glyphicon glyphicon-chevron-right text-warning"></span>${res[item]["list_name"]}<ul class="song_ul"></ul></li>`;
                }
                $("#ul").html(data);
            }
        });
    }

    $("#btn").click(function(){
        layer.prompt({title: "输入歌单名", formType: 0}, function(pass, index){
            if(pass!=""){
                layer.close(index);
                $.ajax({
                    url: "http://127.0.0.1:8086/php/crud.php",
                    data: "action=cl&list_name="+pass+"&u_id=1",
                    type: "get",
                    dataType: "json",
                    success: function(res){
                        if(res.state==1){
                            layer.msg("添加成功", {icon: 1}, function(){
                                getList();
                            });
                        }
                        else{
                            layer.msg("添加失败", {icon: 2});
                        }
                    }
                });
            }
        });
    });

    $("#ul").on("click", function(e){
        if($(e.target).parent().attr("list_id") || $(e.target).attr("list_id")){
            var dealUl;
            if($(e.target).parent().attr("list_id")) dealUl = $(e.target).parent().children().eq(1);
            else dealUl = $(e.target).children().eq(1);
            var icon = dealUl.parent().children().eq(0);
            
            if(icon.hasClass("glyphicon-chevron-right")){
                icon[0].className="";
                icon.addClass("glyphicon glyphicon-chevron-down");
            }
            else if(icon.hasClass("glyphicon-chevron-down")){
                icon[0].className="";
                icon.addClass("glyphicon glyphicon-chevron-right");
            }
            if(dealUl.html()=="") listExtend(dealUl);
            else dealUl.toggle();
        }
        else if($(e.target).attr("m_id"))  play($(e.target));
    })


    function listExtend(jqobj){
        $.ajax({
            url: "http://127.0.0.1:8086/php/crud.php",
            type: "get",
            data: "action=gs&list_id="+jqobj.parent().attr("list_id")+"&u_id=1",
            dataType: "json",
            success: function(res){
                var data = "";
                for(let item of res){
                    data+=`<li m_id="208902">${item["m_name"]} ${item["m_author"]}</li>`;
                }
                jqobj.html(data);
            }
        });
    }



    $("#search").keydown(function(e){
        if(e.keyCode==13){
            location.href="http://10.36.133.110:8086/php/music_search.php?content="+$("#search").val();
        }
    })
</script>
</html>